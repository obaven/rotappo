id: UI-007
title: 'Phenome Runtime State Snapshot + Aggregation'
type: Story
layer: 5
domain: core
component: phenome-runtime-state
cli_surface: []

description: |
  Define a state snapshot model that aggregates action execution status,
  capabilities, storage designation, and health into a single payload.
  The snapshot should be cheap to compute and safe for frequent UI polls.
  Implement it inside lib/phenome with adapters for Primer and Rotato.

deliverables:
  - StateSnapshot struct with action steps, gates, and status fields
  - Aggregation layer that merges action data, config, and cached k8s state
  - JSON serialization for UI surfaces
  - Unit tests for snapshot completeness and defaults
  - Adapter hooks for Primer and Rotato data sources

acceptance_criteria:
  - Snapshot includes action steps with ready/blocked/running states
  - Capabilities and default storage class appear in the snapshot
  - Snapshot retrieval avoids direct kubectl calls per request
  - JSON output is stable for UI clients

dependencies:
  - UI-002

phase_gate: gitops
effort: M
risk: low

labels:
  - ui
  - runtime
  - state
  - aggregation
  - phenome

source_files:
  - file: lib/phenome/src/runtime/state.rs
    context: "Define state snapshot model and aggregation helpers"
  - file: lib/phenome/src/adapters/primer/reconciler.rs
    context: "Expose step status for runtime snapshots"
  - file: lib/phenome/src/adapters/primer/capabilities.rs
    context: "Surface capabilities for snapshot aggregation"
  - file: lib/phenome/src/adapters/primer/config.rs
    context: "Expose config fields needed for snapshots"

status: MustHaves
state: Backlog
status_capsule: (owner:@antigravity, updated:2026-01-01, status:backlog)
assignee: unassigned
