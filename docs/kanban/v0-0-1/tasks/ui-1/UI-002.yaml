id: UI-002
title: 'UI-1A: Phenome Runtime + State API'
type: Epic
layer: 5
domain: core
component: phenome-runtime
cli_surface:
  - phenome ui
  - phenome server

description: |
  Create a shared runtime that exposes actions, state snapshots, and
  event streams for all UI surfaces. This runtime becomes the single
  source of truth for UI data and command execution. Implement the
  runtime inside phenome so it can be developed independently and
  adapted for Primer and Rotato.

deliverables:
  - Phenome runtime modules under phenome/src/runtime
  - Action router and command registry used by all surfaces
  - State snapshot model aggregating action, capabilities, and health
  - Event bus for logs and step transitions
  - Primer + Rotato adapters for runtime data
  - UI configuration schema and persistence

acceptance_criteria:
  - UI surfaces can call a stable action API without direct CLI calls
  - State snapshot can be fetched without heavy cluster polling
  - Log and event streams support live UIs (TUI/Web/Desktop)
  - Runtime remains usable without any UI (headless CLI mode)
  - Runtime compiles as an independent crate under phenome

dependencies:
  - UI-001

children:
  - UI-007
  - UI-008
  - UI-009
  - UI-010

phase_gate: gitops
effort: M
risk: med

labels:
  - ui
  - runtime
  - api
  - core
  - phenome

source_files:
  - file: ../primer/src/main.rs
    context: "CLI entry point; invokes primer::cli::Cli::run"
  - file: ../primer/src/cli/mod.rs
    context: "CLI parser and dispatch wiring"
  - file: ../primer/src/cli/context.rs
    context: "CLI context/config wiring"
  - file: ../primer/src/cli/commands/mod.rs
    context: "CLI command registry"
  - file: ../primer/src/cli/commands/action.rs
    context: "primer assembly command handler"
  - file: ../primer/src/cli/commands/reconcile.rs
    context: "primer reconcile command handler"
  - file: ../primer/src/cli/commands/rotate.rs
    context: "primer rotate command handler"
  - file: ../primer/src/cli/commands/nuke.rs
    context: "primer nuke command handler"
  - file: ../primer/src/cli/commands/debug.rs
    context: "primer debug command handler"
  - file: ../primer/src/cli/commands/cache.rs
    context: "primer cache command handler"
  - file: ../primer/src/cli/commands/generate.rs
    context: "primer generate command handler"
  - file: ../primer/src/cli/commands/visualize.rs
    context: "primer visualize command handler"
  - file: ../primer/src/bin/test_action_load.rs
    context: "CLI test harness for action loading"

status: MustHaves
state: Backlog
status_capsule: (owner:@antigravity, updated:2026-01-01, status:backlog)
assignee: unassigned
